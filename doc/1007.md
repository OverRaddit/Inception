# 10/7

## 금일 목표
- WordPress + php-fpm 셋팅
- MariaDB 셋팅
- NGINX TLS가 뭔지 조사하고 셋팅하기

- WordPress DB를 포함하는 volume 생성
- WordPress website files를 포함하는 두번째 volume 생성
- 컨테이너들간을 연결하는 도커네트워크 설립. <- 이건 docker-compose가 해준다.

## 오늘의 업적
- 10:30 전에 옴옴

## 10:22
뮤님과 자체 모닝글로리 다녀왔다가 인셉션 착수.
NGINX의 설정파일을 직접 적용해보는 연습해보기.

## 10:29
도커를 설치하고 init_docker를 돌렸는데 관리자권한을 요청받았다.
도커를 삭제하고 재설치중.. 성공!

## 11:01
도커 명령어를 간편하게 칠수있게 awk로 몇개 써놓음
현재 COPY한 서버블록이 적용되는지 알수가없음 -> 판단을 위해 리스닝소켓의 포트를 변경해보자.

## 11:04
리스닝 소켓을 42로 변경했고 docker-compose내에서 외부 443포트를 80으로 매핑시켜두었다.
즉 현재 호스트에서 443포트로 접근하면 컨테이너 내부의 80포트와 연결되고
NGINX는 컨테이너 내부의 80이 아닌 42포트에서 열리기 때문에 동작하지 않아야 한다.
그런데 응답이 여전히 나오는 것으로 보아 복사된 파일은 설정파일로 적용되지 않고 있다.

## 11:28
해당 컨테이너를 배쉬로 돌아다녀보니 /etc/nginx/http.d/default.conf가 존재함.
이를 COPY를 통해 내가 만든 파일로 바꾸었더니 적용이 된 것을 확인했다.
원래 기본 welcome페이지를 띄우려고했는데 어떻게 하는지 몰라서 못하고있다.
location 블록으로 응답코드를 주면 해당 HTML파일을 응답하는줄 알고 적어보았는데
요청한 URL에 해당하는 빈파일을 반환한다.

## 12:33
subject를 읽다가 daemon에 대해 알아보라는 내용을 읽어 조사해보았다.
조사한 내용을 whis_is_daemon.md에 정리했다.
daemon이 뭔지 아예 잘못알고있었고 리눅스 프로세스에 대한 이해가 좀 더 깊어진 느낌이다.

## 12:49
subject를 보니 디렉토리에 makefile이 있길래 자주쓰던 명령어를 makefile에 등록했다.
wordpress랑 mariadb컨테이너를 각각 띄워보자

두 컨테이너를 compose파일에서 어떻게 포트포워딩을 할지 고민했는데..
생각해보니 포트포워딩은 외부와 내부의 포트를 연결할 때만 사용하면 된다.
포트포워딩을 통해 외부내부가 연결될 필요가 있는 컨테이너는 NGINX뿐이다.
나머지는 NGINX가 내부적으로 각 포트에 접근하면 된다.
내부적으로 포트를 여는 방법은 각 컨테이너에서
```dockerfile
EXPOSE 80/tcp
```
를 통해 가능하다.

## 13:10
각 도커파일을 열었을때 무슨 컨테이너인지 보여주고싶어서 쁘띠하게 꾸며봤다.
현재 마리아디비 실행환경을 가지는 컨테이너를 띄우는데 성공했다.
apk를 이용해 mariadb mariadb-common mariadb-client를 설치했다.
각 모듈이 무슨 역할을 하는지에 대한 이해가 필요하다.

## 13:42
mariadb의 초기화를 위해 /etc/init.d/mariadb setup를 수행하지만
openrc 오류가 발생한다.

알파인 리눅스는 openrc를 init system으로 한다는데...
왜 내가 openrc를 쓰려면 수동으로 설치해야 하는지 모르겠다.
그리고 막상 openrc 관련 명령어를 쓰려고 하면 openrc로 부팅되지 않은 시스템이라는 경고가 발생한다.

## 15:26
점심먹고 다시왔다.
일단 리눅스의 Init 시스템에 대해 공부해야 한다.
그 다음에 service를 실행하는 방법(현재 아는건 service명령어, openrc명령어)를 조사.
마리아디비를 사용하는 과정과 그 사이에 일어나는 일들에 대해 조사해야 함.