# Storage (https://docs.docker.com/storage/)

## Manage data in Docker

컨테이너 내부에서 생성되는 모든 파일은 기본적으로 writable container layer에 저장된다.
이것은 다음을 의미한다.
- 컨테이너가 사라지면, 데이터가 유지되지 않는다. 또한 다른 프로세스가 컨테이너 밖에서 데이터를 가져가기 어려워진다.
- 컨테이너의 writable layer는 컨테이너가 돌고있는 호스트 머신과 견고하게 결합되어 있다. 데이터를 다른 곳으로 이동할 수 없다.
- -> 이게 무슨말인지 모르겠다. 왜 결합되어 있다는건지, 결합된거랑 데이터를 이동시키는 거랑 무슨상관?
- 컨테이너의 w layer에 write를 하는 행위는 파일시스템을 관리하는 **storage driver**를 필요로 한다. 그것은 리눅스 커널을 이용하여 union filesystem을 제공한다. 이러한 추가 추상화는 호스트 파일 시스템에 직접 쓰는 데이터 볼륨을 사용하는 경우와 비교하여 성능을 감소시킵니다.
- -> union filesystem이란?

도커는 컨테이너가 호스트머신에 파일을 저장하기 위한 2가지 옵션을 가지고 있다. 그렇게 하여 파일이 컨테이너가 stop된 이후에도 유지되도록 한다. ->  volumes, bind mounts

도커는 또한 컨테이너가 호스트머신의 in-memory에 파일을 저장하는 것을 지원한다. 특정파일은 보존되지 않는다. 만약 너가 리눅스위에서 도커를 돌리고 있다면, tmpfs mount가 호스트 시스템 메모리에서 파일을 저장하는데 사용된다. 윈도우라면, named pipe가 사용됨.
-> in-memory가 뭐지.

### Choose the right type of mount

너가 사용하기로 선택할 어떤 마운트 타입을 사용하던, 데이터는 컨테이너에서 똑같이 보인다.
volume, bind mount, tmpfs mount를 구분해봅시다.

- volume은 도커에 의해 관리되는 호스트 파일시스템의 일부에 저장된다.
  - 도커가 아닌 프로세스는 이 곳의 파일시스템을 수정할 수 없다.
  - 볼륨은 도커에서 데이터를 보존하는 최고의 방법이다.

- Bind mount는 호스트 시스템의 어디든지 간에 저장합니다.
  - 도커 호스트 또는 도커 컨테이너의 비도커 프로세스는 언제든지 수정할 수 있습니다.
  - -> 이게 뭔 개소리냐;; 비도커라면서 도커호스트/도커 컨테이너는 뭔데

- tmpfs mount는 호스트 시스템의 메모리에만 저장된다.
  - 절대 호스트 시스템의 파일시스템에 write하지 않는다.

#### More details about mount types

## Use volumes (https://docs.docker.com/storage/volumes/)

bind mounts가 디렉토리구조, 호스트머신의 OS에 의존적인데 비해 볼륨은 도커에게 전적으로 관리된다.

bind mounts에 비해 볼륨의 장점
- 백업/migrate가 더 용이함
- docker api, docker cli command로 volume을 관리할 수 있음
- 리눅스 윈도우 컨테이너에 상관없이 작동함
- 다수의 컨테이너 사이에서 안전하게 공유됨
- Volume driver는 원격 호스트나 클라우드 제공자에게 볼륨을 저장할 수 있게 해준다.
  - 볼륨 내용물을 암호화하거나 다른 기능을 추가하기 위해.
- 새 볼륨은 컨테이너에 의해 콘텐츠가 미리 채워질 수 있습니다.
- Docker Desktop의 볼륨은 Mac 및 윈도우즈 호스트의 바인딩 마운트보다 훨씬 높은 성능을 제공합니다.

추가적으로, 볼륨은 컨테이너의 w layer에 데이터를 보존하는 것보다 좋은 선택이다.
볼륨은 컨테이너의 크기를 늘리지 않는다.
볼륨은 주어진 컨테이너의 생명주기 밖에 존재한다.

컨테이너가 비영구적 상태 데이터를 생성하는 경우 tmpfs 마운트를 사용하여 데이터를 영구적으로 저장하지 않도록 하고 컨테이너의 w layer에 쓰기를 방지하여 컨테이너의 성능을 향상시키십시오.